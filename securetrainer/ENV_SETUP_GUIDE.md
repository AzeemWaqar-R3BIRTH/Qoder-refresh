# üîß SecureTrainer Environment Configuration Guide

## üöÄ Quick Setup

### Option 1: Automated Setup (Recommended)
```bash
cd securetrainer
python setup_env.py
```

### Option 2: Manual Setup
1. Copy `env_template.txt` to `.env`
2. Edit the `.env` file with your settings
3. Save the file

## üìß Email Configuration

### Gmail Setup (Recommended for Development)
1. **Enable 2-Factor Authentication** on your Gmail account
2. **Generate App Password**:
   - Go to Google Account Settings
   - Security ‚Üí 2-Step Verification ‚Üí App passwords
   - Generate password for "Mail"
3. **Use the App Password** in your `.env` file

### Example Gmail Configuration
```env
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-16-digit-app-password
```

### Other Email Providers
- **Outlook/Hotmail**: `smtp-mail.outlook.com:587`
- **Yahoo**: `smtp.mail.yahoo.com:587`
- **Custom SMTP**: Use your provider's settings

## üóÑÔ∏è Database Configuration

### Local MongoDB
```bash
# Install MongoDB Community Edition
# Start MongoDB service
mongod --dbpath /path/to/data/db
```

```env
MONGO_URI=mongodb://localhost:27017/securetrainer
```

### MongoDB Atlas (Cloud)
1. **Create Cluster** at [mongodb.com/atlas](https://mongodb.com/atlas)
2. **Get Connection String**:
   ```
   mongodb+srv://username:password@cluster.mongodb.net/securetrainer?retryWrites=true&w=majority
   ```
3. **Replace** `username`, `password`, and `cluster` with your details

## üîê Security Configuration

### Secret Key Generation
```python
import secrets
import string

# Generate a secure 32-character key
alphabet = string.ascii_letters + string.digits + string.punctuation
secret_key = ''.join(secrets.choice(alphabet) for _ in range(32))
print(secret_key)
```

### Minimum Security Settings
```env
SECRET_KEY=your-generated-secret-key-here
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax
RATE_LIMIT_ENABLED=True
CSRF_ENABLED=True
```

## ‚öôÔ∏è Application Settings

### Development Mode
```env
FLASK_ENV=development
FLASK_DEBUG=True
DEBUG=True
HOST=0.0.0.0
PORT=5000
```

### Production Mode
```env
FLASK_ENV=production
FLASK_DEBUG=False
DEBUG=False
HOST=127.0.0.1
PORT=5000
SESSION_COOKIE_SECURE=True
LOG_LEVEL=WARNING
```

## üéØ Challenge System Configuration

### Basic Settings
```env
MAX_HINTS_PER_CHALLENGE=3
HINT_PENALTY_PERCENTAGE=10
BASE_CHALLENGE_POINTS=100
LEVEL_UP_THRESHOLD=1000
ENABLED_CHALLENGES=sql_injection,xss,command_injection,authentication,csrf
```

### Role Progression
```env
ROLE_THRESHOLDS=1000,2500,5000,10000,20000
ROLE_NAMES=Trainee,Analyst,Specialist,Expert,Department Head
```

## ü§ñ AI/ML Configuration

### Model Paths
```env
MODEL_PATH=./model/challenge_difficulty_model.pkl
LABEL_ENCODER_PATH=./model/label_encoder.pkl
AI_ENABLED=True
AI_FALLBACK_ENABLED=True
```

## üì± QR Code Configuration

### Storage and Security
```env
QR_STORAGE_PATH=./qr_codes
QR_EXPIRY_HOURS=24
QR_TOKEN_LENGTH=32
QR_ENCRYPTION_KEY=your-encryption-key-here
```

## üìä Logging Configuration

### Basic Logging
```env
LOG_LEVEL=INFO
LOG_FILE=./logs/securetrainer.log
LOG_MAX_SIZE=10MB
LOG_BACKUP_COUNT=5
```

### Create Log Directory
```bash
mkdir -p logs
mkdir -p qr_codes
mkdir -p backups
```

## üîç Testing Your Configuration

### 1. Check Environment Variables
```python
from dotenv import load_dotenv
import os

load_dotenv()
print(f"Email: {os.getenv('MAIL_USERNAME')}")
print(f"Database: {os.getenv('MONGO_URI')}")
print(f"Secret Key: {os.getenv('SECRET_KEY')[:10]}...")
```

### 2. Test Email Connection
```python
from flask_mail import Mail
from app import app

mail = Mail(app)
# If no errors, email configuration is correct
```

### 3. Test Database Connection
```python
from pymongo import MongoClient
import os

client = MongoClient(os.getenv('MONGO_URI'))
db = client.get_database()
print("Database connected successfully!")
```

## üö® Common Issues and Solutions

### Email Issues
- **Authentication Failed**: Use App Password, not regular password
- **Connection Refused**: Check firewall and port settings
- **TLS Error**: Ensure `MAIL_USE_TLS=True`

### Database Issues
- **Connection Failed**: Check if MongoDB is running
- **Authentication Error**: Verify username/password in connection string
- **Network Error**: Check firewall and network settings

### Security Issues
- **Weak Secret Key**: Generate a longer, more random key
- **Missing CSRF**: Ensure `CSRF_ENABLED=True`
- **Session Issues**: Check cookie settings

## üìã Complete Example .env File

```env
# SecureTrainer Environment Configuration
# Generated by setup script

# Security
SECRET_KEY=K8m#P$2vL9q@R5nX7wE4tY1uI6oA3sD8fG2hJ4kL6mN9pQ1rS4tU7vW0xY3z

# Email Configuration
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USE_SSL=False
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=abcd efgh ijkl mnop
MAIL_DEFAULT_SENDER=SecureTrainer <your-email@gmail.com>

# Database
MONGO_URI=mongodb://localhost:27017/securetrainer
MONGO_DB_NAME=securetrainer

# Application Settings
FLASK_ENV=development
FLASK_DEBUG=True
HOST=0.0.0.0
PORT=5000
APP_URL=http://localhost:5000

# AI/ML Models
MODEL_PATH=./model/challenge_difficulty_model.pkl
LABEL_ENCODER_PATH=./model/label_encoder.pkl
AI_ENABLED=True
AI_FALLBACK_ENABLED=True

# QR Code Settings
QR_STORAGE_PATH=./qr_codes
QR_EXPIRY_HOURS=24
QR_TOKEN_LENGTH=32

# Challenge System
MAX_HINTS_PER_CHALLENGE=3
HINT_PENALTY_PERCENTAGE=10
BASE_CHALLENGE_POINTS=100
LEVEL_UP_THRESHOLD=1000
ENABLED_CHALLENGES=sql_injection,xss,command_injection,authentication,csrf

# Gamification
POINTS_MULTIPLIER=1.0
BONUS_POINTS_ENABLED=True
STREAK_BONUS_ENABLED=True
ROLE_THRESHOLDS=1000,2500,5000,10000,20000
ROLE_NAMES=Trainee,Analyst,Specialist,Expert,Department Head

# Logging
LOG_LEVEL=INFO
LOG_FILE=./logs/securetrainer.log
LOG_MAX_SIZE=10MB
LOG_BACKUP_COUNT=5

# Security
SESSION_COOKIE_SECURE=False
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax
PERMANENT_SESSION_LIFETIME=3600
RATE_LIMIT_ENABLED=True
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600
CSRF_ENABLED=True
CSRF_TIME_LIMIT=3600

# Development
DEBUG=True
TESTING=False
AUTO_RELOAD=True

# Notifications
SEND_WELCOME_EMAIL=True
SEND_CHALLENGE_COMPLETION_EMAIL=True
SEND_PROMOTION_EMAIL=True
SEND_WEEKLY_PROGRESS_EMAIL=False

# Company Branding
COMPANY_NAME=SecureTrainer
COMPANY_WEBSITE=https://securetrainer.com
THEME_COLOR=#1e40af
ACCENT_COLOR=#f59e0b
SUCCESS_COLOR=#10b981
ERROR_COLOR=#ef4444
```

## üéâ Next Steps

1. **Run the setup script**: `python setup_env.py`
2. **Review the generated .env file**
3. **Test your configuration**
4. **Start the application**: `python start.py`
5. **Access the platform**: Open `http://localhost:5000`

## üìû Need Help?

- Check the logs in `./logs/securetrainer.log`
- Review the error messages in the console
- Ensure all required services are running
- Verify your credentials are correct

---

**Remember**: Never commit your `.env` file to version control! It contains sensitive information.
